/**
 ********************************************************************************
 *** MarsnewsXMLImporter.java                                                 ***
 *** generated by AnoSiteGenerator (ASG), Version: 1.3.3                      ***
 *** Copyright (C) 2005 - 2010 Anotheria.net, www.anotheria.net               ***
 *** All Rights Reserved.                                                     ***
 ********************************************************************************
 *** Don't edit this code, if you aren't sure                                 ***
 *** that you do exactly know what you are doing!                             ***
 *** It's better to invest time in the generator, as into the generated code. ***
 ********************************************************************************
 */

package net.anotheria.marsnews.gen.shared.service;

import java.util.List;
import java.util.ArrayList;
import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;
import java.io.IOException;
import java.io.OutputStreamWriter;
import org.jdom.Element;
import org.jdom.Attribute;
import org.jdom.Document;
import java.io.StringReader;
import org.jdom.JDOMException;
import org.jdom.input.SAXBuilder;
import net.anotheria.util.xml.XMLNode;
import net.anotheria.util.xml.XMLTree;
import net.anotheria.util.xml.XMLAttribute;
import net.anotheria.util.xml.XMLWriter;
import net.anotheria.util.Date;
import net.anotheria.asg.exception.ASGRuntimeException;
import org.apache.log4j.BasicConfigurator;
import net.anotheria.marsnews.gen.rankedcountries.service.RankedCountriesServiceFactory;

public class MarsnewsXMLImporter{



	public MarsnewsXMLImporter(){
		AnoDocConfigurator.configure();
	}

	public static Document parseDocument(String content) throws JDOMException, IOException{
		SAXBuilder reader = new SAXBuilder();;
		reader.setValidation(false);
		Document doc = reader.build(new StringReader(content));
		return doc;
	}

	/**
	 * Create an XML Document (ano-util) with data from all modules.
	 */
	public XMLTree createCompleteXMLExport() throws ASGRuntimeException{
		ArrayList<XMLNode> nodes = new ArrayList<XMLNode>();
		nodes.add(RankedCountriesServiceFactory.createRankedCountriesService().exportToXML());
		return createExport(nodes);
	}

	/**
	 * Write XML data from all modules into given stream.
	 */
	public void writeCompleteXMLExportToStream(OutputStream target) throws IOException, ASGRuntimeException{
		new XMLWriter().write(createCompleteXMLExport(), target);
	}

	/**
	 * Write XML data from all modules into given file.
	 */
	public void writeCompleteXMLExportToFile(File target) throws IOException, ASGRuntimeException{
		writeToFile(createCompleteXMLExport(), target);
	}

	/**
	 * Create an XML Document (jdom) from RankedCountries data for export.
	 */
	public XMLTree createRankedCountriesXMLExport() throws ASGRuntimeException{
		ArrayList<XMLNode> nodes = new ArrayList<XMLNode>(1);
		nodes.add(RankedCountriesServiceFactory.createRankedCountriesService().exportToXML());
		return createExport(nodes);
	}

	/**
	 * Write RankedCountries as XML into given stream.
	 */
	public void writeRankedCountriesXMLExportToStream(OutputStream target) throws IOException, ASGRuntimeException{
		new XMLWriter().write(createRankedCountriesXMLExport(), target);
	}

	/**
	 * Write RankedCountries as XML into given file.
	 */
	public void writeRankedCountriesXMLExportToFile(File target) throws IOException, ASGRuntimeException{
		writeToFile(createRankedCountriesXMLExport(), target);
	}

	private void writeToFile(XMLTree tree, File target) throws IOException{
		FileOutputStream fOut = null;
		try{
			fOut = new FileOutputStream(target);
			XMLWriter writer = new XMLWriter();
			OutputStreamWriter oWriter = writer.write(tree, fOut);
			oWriter.close();
		}catch(IOException e){;
			if (fOut!=null){
				try{
					fOut.close();
				}catch(IOException ignored){}
			}
			throw e;
		}
	}

	private XMLTree createExport(List<XMLNode> nodes){
		XMLTree tree = new XMLTree();
		tree.setEncoding("utf-8");
		XMLNode root = new XMLNode("export");
		root.addAttribute(new XMLAttribute("timestamp", ""+System.currentTimeMillis()));
		root.addAttribute(new XMLAttribute("date", Date.currentDate().toString()));
		tree.setRoot(root);
		root.setChildren(nodes);
		return tree;
	}

	public static void main(String[] a) throws IOException,ASGRuntimeException{
		BasicConfigurator.configure();
		new MarsnewsXMLImporter().writeCompleteXMLExportToFile(new File("marsnews_export.xml"));
	}
}
