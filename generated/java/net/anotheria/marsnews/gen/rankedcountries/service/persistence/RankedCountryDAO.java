/**
 **************************************************************************************
 *** RankedCountryDAO.java                                                          ***
 *** Generator: net.anotheria.asg.generator.model.db.PersistenceServiceDAOGenerator ***
 *** generated by AnoSiteGenerator (ASG), Version: 1.3.3                            ***
 *** Copyright (C) 2005 - 2010 Anotheria.net, www.anotheria.net                     ***
 *** All Rights Reserved.                                                           ***
 **************************************************************************************
 *** Don't edit this code, if you aren't sure                                       ***
 *** that you do exactly know what you are doing!                                   ***
 *** It's better to invest time in the generator, as into the generated code.       ***
 **************************************************************************************
 */

package net.anotheria.marsnews.gen.rankedcountries.service.persistence;

import java.util.List;
import java.util.ArrayList;
import java.util.concurrent.atomic.AtomicLong;
import net.anotheria.marsnews.gen.rankedcountries.data.RankedCountry;
import net.anotheria.marsnews.gen.rankedcountries.data.RankedCountryVO;
import net.anotheria.db.dao.DAO;
import net.anotheria.db.dao.DAOException;
import net.anotheria.db.dao.DAOSQLException;
import net.anotheria.db.dao.RowMapper;
import net.anotheria.anodoc.query2.QueryProperty;
import net.anotheria.anodoc.util.context.DBContext;
import net.anotheria.anodoc.util.context.ContextManager;
import net.anotheria.util.slicer.Segment;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import org.apache.log4j.Logger;
import net.anotheria.db.config.JDBCConfigFactory;
import net.anotheria.db.config.JDBCConfig;
import java.lang.IllegalArgumentException;

public class RankedCountryDAO implements DAO{

	private static Logger log = Logger.getLogger(RankedCountryDAO.class);
	public static final String TABNAME = "rankedcountry";

	public static final String ATT_NAME_ID = "id";
	public static final String ATT_NAME_RANK 	 = "rank";
	public static final String ATT_NAME_COUNTRYNAME 	 = "countryname";
	public static final String ATT_NAME_COUNTRYID 	 = "countryid";
	public static final String ATT_NAME_LAND 	 = "land";
	public static final String ATT_NAME_NETWORTH 	 = "networth";
	public static final String ATT_NAME_COLOR 	 = "color";
	public static final String ATT_NAME_CLAN 	 = "clan";
	public static final String ATT_NAME_GOV 	 = "gov";
	public static final String ATT_NAME_GDI 	 = "gdi";
	public static final String ATT_NAME_DEAD 	 = "dead";
	public static final String ATT_NAME_PROTECTION 	 = "protection";

	public static final String  SQL_CREATE_1 	= "INSERT INTO ";
	public static final String  SQL_CREATE_2 	= " ("+ATT_NAME_ID+", "+ATT_NAME_RANK+", "+ATT_NAME_COUNTRYNAME+", "+ATT_NAME_COUNTRYID+", "+ATT_NAME_LAND+", "+ATT_NAME_NETWORTH+", "+ATT_NAME_COLOR+", "+ATT_NAME_CLAN+", "+ATT_NAME_GOV+", "+ATT_NAME_GDI+", "+ATT_NAME_DEAD+", "+ATT_NAME_PROTECTION+", "+ATT_NAME_DAO_CREATED+") VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?)";
	public static final String  SQL_UPDATE_1 	= "UPDATE ";
	public static final String  SQL_UPDATE_2 	= " SET " + ATT_NAME_RANK + " = ?, " + ATT_NAME_COUNTRYNAME + " = ?, " + ATT_NAME_COUNTRYID + " = ?, " + ATT_NAME_LAND + " = ?, " + ATT_NAME_NETWORTH + " = ?, " + ATT_NAME_COLOR + " = ?, " + ATT_NAME_CLAN + " = ?, " + ATT_NAME_GOV + " = ?, " + ATT_NAME_GDI + " = ?, " + ATT_NAME_DEAD + " = ?, " + ATT_NAME_PROTECTION + " = ?, " + ATT_NAME_DAO_UPDATED + " = ?" + " WHERE " + ATT_NAME_ID + " = ?";
	public static final String  SQL_DELETE_1 	= "DELETE FROM ";
	public static final String  SQL_DELETE_2 	= " WHERE " + TABNAME +"." + ATT_NAME_ID + " = ?";
	public static final String  SQL_READ_ONE_1 	= "SELECT "+ATT_NAME_ID+", "+ATT_NAME_RANK+", "+ATT_NAME_COUNTRYNAME+", "+ATT_NAME_COUNTRYID+", "+ATT_NAME_LAND+", "+ATT_NAME_NETWORTH+", "+ATT_NAME_COLOR+", "+ATT_NAME_CLAN+", "+ATT_NAME_GOV+", "+ATT_NAME_GDI+", "+ATT_NAME_DEAD+", "+ATT_NAME_PROTECTION+", "+ATT_NAME_DAO_CREATED+", "+ATT_NAME_DAO_UPDATED+" FROM ";
	public static final String  SQL_READ_ONE_2 	= " WHERE " + TABNAME +"." + ATT_NAME_ID + " = ?";
	public static final String  SQL_READ_ALL_1 	= "SELECT "+ATT_NAME_ID+", "+ATT_NAME_RANK+", "+ATT_NAME_COUNTRYNAME+", "+ATT_NAME_COUNTRYID+", "+ATT_NAME_LAND+", "+ATT_NAME_NETWORTH+", "+ATT_NAME_COLOR+", "+ATT_NAME_CLAN+", "+ATT_NAME_GOV+", "+ATT_NAME_GDI+", "+ATT_NAME_DEAD+", "+ATT_NAME_PROTECTION+", "+ATT_NAME_DAO_CREATED+", "+ATT_NAME_DAO_UPDATED+" FROM ";
	public static final String  SQL_READ_ALL_2 	= " ORDER BY id";
	public static final String  SQL_READ_ALL_BY_PROPERTY_1 	= "SELECT "+ATT_NAME_ID+", "+ATT_NAME_RANK+", "+ATT_NAME_COUNTRYNAME+", "+ATT_NAME_COUNTRYID+", "+ATT_NAME_LAND+", "+ATT_NAME_NETWORTH+", "+ATT_NAME_COLOR+", "+ATT_NAME_CLAN+", "+ATT_NAME_GOV+", "+ATT_NAME_GDI+", "+ATT_NAME_DEAD+", "+ATT_NAME_PROTECTION+", "+ATT_NAME_DAO_CREATED+", "+ATT_NAME_DAO_UPDATED+" FROM ";
	public static final String  SQL_READ_ALL_BY_PROPERTY_2 	= " WHERE ";
	public static final String  SQL_COUNT_1 	= "SELECT COUNT(id) FROM ";
	public static final String  SQL_LIMIT_1 	= " LIMIT ?";
	public static final String  SQL_OFFSET_1 	= " OFFSET ?";

	private RowMapper<RankedCountry> rowMapper = new RankedCountryRowMapper();

	private AtomicLong lastId = new AtomicLong();
	private JDBCConfig dbConfig = JDBCConfigFactory.getJDBCConfig();

	private AtomicLong getLastId(Connection con) throws DAOException {
		return lastId;
	}

	private void adjustLastId(Connection con, long lastIdValue) throws DAOException {
		if (lastId.get()<lastIdValue)
			lastId.set(lastIdValue);
	}

	private String createSQL(String sql1, String sql2){
		StringBuilder sql = new StringBuilder();
		sql.append(sql1).append(TABNAME).append(sql2);
		return sql.toString();
	}

	/**
	 * Returns all RankedCountrys objects stored.
	 */
	public List<RankedCountry> getRankedCountrys(Connection con) throws DAOException {
		PreparedStatement ps = null;
		ResultSet result = null;
		try {
			con.setAutoCommit(true);
			ps = con.prepareStatement(createSQL(SQL_READ_ALL_1, SQL_READ_ALL_2));
			result = ps.executeQuery();
			ArrayList<RankedCountry> ret = new ArrayList<RankedCountry>();
			while(result.next())
				ret.add(rowMapper.map(result));
			return  ret;
		} catch (SQLException e) {
			log.error("getRankedCountrys("+con+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Deletes a RankedCountry object by id.
	 */
	public void deleteRankedCountry(Connection con, String id) throws DAOException {
		PreparedStatement ps = null;
		try {
			con.setAutoCommit(true);
			ps = con.prepareStatement(createSQL(SQL_DELETE_1, SQL_DELETE_2));
			ps.setLong(1, Long.parseLong(id));
			int rows = ps.executeUpdate();
			if (rows!=1 && rows!=0){
				log.warn("Deleted more than one row of RankedCountry: "+id);
			}
		} catch (SQLException e) {
			log.error("deleteRankedCountry("+con+", "+id+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Deletes multiple RankedCountry objects.
	 */
	public void deleteRankedCountrys(Connection con, List<RankedCountry> list) throws DAOException {
		PreparedStatement ps = null;
		try{
			con.setAutoCommit(false);
			ps = con.prepareStatement(createSQL(SQL_DELETE_1, SQL_DELETE_2));
			for (RankedCountry rankedcountry : list){
				ps.setLong(1, Long.parseLong(rankedcountry.getId()));
				int rows = ps.executeUpdate();
				if (rows!=1 && rows!=0){
					log.warn("Deleted more than one row of RankedCountry: "+rankedcountry.getId());
				}
			}
			con.commit();
		} catch (SQLException e) {
			log.error("deleteRankedCountrys("+con+", "+list+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Returns the RankedCountry object with the specified id.
	 */
	public RankedCountry getRankedCountry(Connection con, String id) throws DAOException {
		if(con == null)
			throw new IllegalArgumentException("Null arg: con");
		if(id == null)
			throw new IllegalArgumentException("Null arg: id");
		PreparedStatement ps = null;
		ResultSet result = null;
		try {
			con.setAutoCommit(true);
			ps = con.prepareStatement(createSQL(SQL_READ_ONE_1, SQL_READ_ONE_2));
			ps.setLong(1, Long.parseLong(id));
			result = ps.executeQuery();
			if (!result.next())
				throw new RankedCountryDAONoItemForIdFoundException(id);
			return rowMapper.map(result);
		} catch (SQLException e) {
			log.error("getRankedCountry("+con+", "+id+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Imports a new RankedCountry object.
	 * Returns the imported version.
	 */
	public RankedCountry importRankedCountry(Connection con, RankedCountry rankedcountry) throws DAOException {
		PreparedStatement ps = null;
		try {
			con.setAutoCommit(true);
			ps = con.prepareStatement(createSQL(SQL_CREATE_1, SQL_CREATE_2));
			ps.setLong(1, Long.parseLong(rankedcountry.getId()));
			ps.setInt(2, rankedcountry.getRank());
			ps.setString(3, rankedcountry.getCountryName());
			ps.setInt(4, rankedcountry.getCountryId());
			ps.setInt(5, rankedcountry.getLand());
			ps.setInt(6, rankedcountry.getNetworth());
			ps.setInt(7, rankedcountry.getColor());
			ps.setString(8, rankedcountry.getClan());
			ps.setInt(9, rankedcountry.getGov());
			ps.setBoolean(10, rankedcountry.getGdi());
			ps.setBoolean(11, rankedcountry.getDead());
			ps.setBoolean(12, rankedcountry.getProtection());
			// set create timestamp
			ps.setLong(13, System.currentTimeMillis());
			int rows = ps.executeUpdate();
			if (rows!=1)
				throw new DAOException("Create failed, updated rows: "+rows);
			RankedCountryVO newRankedcountry = new RankedCountryVO(rankedcountry.getId());
			newRankedcountry.copyAttributesFrom(rankedcountry);
			adjustLastId(con, Long.parseLong(rankedcountry.getId()));
			return newRankedcountry;
		} catch (SQLException e) {
			log.error("importRankedCountry("+con+", "+rankedcountry+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Imports multiple new RankedCountry objects.
	 * Returns the imported versions.
	 */
	public List<RankedCountry> importRankedCountrys(Connection con,List<RankedCountry> list) throws DAOException {
		PreparedStatement ps = null;
		try{
			con.setAutoCommit(false);
			ps = con.prepareStatement(createSQL(SQL_CREATE_1, SQL_CREATE_2));
			List<RankedCountry> ret = new ArrayList<RankedCountry>();
			for (RankedCountry rankedcountry : list){
				ps.setLong(1, Long.parseLong(rankedcountry.getId()));
				ps.setInt(2, rankedcountry.getRank());
				ps.setString(3, rankedcountry.getCountryName());
				ps.setInt(4, rankedcountry.getCountryId());
				ps.setInt(5, rankedcountry.getLand());
				ps.setInt(6, rankedcountry.getNetworth());
				ps.setInt(7, rankedcountry.getColor());
				ps.setString(8, rankedcountry.getClan());
				ps.setInt(9, rankedcountry.getGov());
				ps.setBoolean(10, rankedcountry.getGdi());
				ps.setBoolean(11, rankedcountry.getDead());
				ps.setBoolean(12, rankedcountry.getProtection());
				// set create timestamp
				ps.setLong(13, System.currentTimeMillis());
				int rows = ps.executeUpdate();
				if (rows!=1)
					throw new DAOException("Create failed, updated rows: "+rows);
				RankedCountryVO newRankedcountry = new RankedCountryVO(rankedcountry.getId());
				newRankedcountry.copyAttributesFrom(rankedcountry);
				adjustLastId(con, Long.parseLong(rankedcountry.getId()));
				ret.add(newRankedcountry);
			}
			con.commit();
			return ret;
		} catch (SQLException e) {
			log.error("import RankedCountrys("+con+", "+list+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Creates a new RankedCountry object.
	 * Returns the created version.
	 */
	public RankedCountry createRankedCountry(Connection con, RankedCountry rankedcountry) throws DAOException {
		java.sql.SQLException throwable = null;
		for (int recoveryAttempt = 1; recoveryAttempt <= dbConfig.getIdRecoveryAttempts(); recoveryAttempt++) {
			PreparedStatement ps = null;
			try {
				con.setAutoCommit(false);
				ps = con.prepareStatement(createSQL(SQL_CREATE_1, SQL_CREATE_2));
				long nextId = getLastId(con).incrementAndGet();
				ps.setLong(1, nextId);
				ps.setInt(2, rankedcountry.getRank());
				ps.setString(3, rankedcountry.getCountryName());
				ps.setInt(4, rankedcountry.getCountryId());
				ps.setInt(5, rankedcountry.getLand());
				ps.setInt(6, rankedcountry.getNetworth());
				ps.setInt(7, rankedcountry.getColor());
				ps.setString(8, rankedcountry.getClan());
				ps.setInt(9, rankedcountry.getGov());
				ps.setBoolean(10, rankedcountry.getGdi());
				ps.setBoolean(11, rankedcountry.getDead());
				ps.setBoolean(12, rankedcountry.getProtection());
				// set create timestamp
				ps.setLong(13, System.currentTimeMillis());
				int rows = ps.executeUpdate();
				if (rows!=1)
					throw new DAOException("Create failed, updated rows: "+rows);
				RankedCountryVO newRankedcountry = new RankedCountryVO(""+nextId);
				newRankedcountry.copyAttributesFrom(rankedcountry);
				con.commit();
				return newRankedcountry;
			} catch (SQLException e) {
				getLastId(con).set(getMaxId(con,TABNAME));
				log.warn("Failed attempt" +recoveryAttempt+ " from " +dbConfig.getIdRecoveryAttempts()+ " to create new entry in "+TABNAME+" table", e);
				throwable = e;
				continue;
			} finally {
				net.anotheria.db.util.JDBCUtil.release(ps);
			}
		}
		log.error("All "+ dbConfig.getIdRecoveryAttempts()+" attempt of id rereading - Failed. "+"createRankedCountry("+con+", "+rankedcountry+")", throwable);
		throw new DAOSQLException(throwable);
	}

	/**
	 * Creates multiple new RankedCountry objects.
	 * Returns the created versions.
	 */
	public List<RankedCountry> createRankedCountrys(Connection con, List<RankedCountry> list) throws DAOException {
		java.sql.SQLException throwable = null;
		for (int recoveryAttempt = 1; recoveryAttempt <= dbConfig.getIdRecoveryAttempts(); recoveryAttempt++) {
			PreparedStatement ps = null;
			try{
				con.setAutoCommit(false);
				ps = con.prepareStatement(createSQL(SQL_CREATE_1, SQL_CREATE_2));
				List<RankedCountry> ret = new ArrayList<RankedCountry>();
				for (RankedCountry rankedcountry : list){
					long nextId = getLastId(con).incrementAndGet();
					ps.setLong(1, nextId);
					ps.setInt(2, rankedcountry.getRank());
					ps.setString(3, rankedcountry.getCountryName());
					ps.setInt(4, rankedcountry.getCountryId());
					ps.setInt(5, rankedcountry.getLand());
					ps.setInt(6, rankedcountry.getNetworth());
					ps.setInt(7, rankedcountry.getColor());
					ps.setString(8, rankedcountry.getClan());
					ps.setInt(9, rankedcountry.getGov());
					ps.setBoolean(10, rankedcountry.getGdi());
					ps.setBoolean(11, rankedcountry.getDead());
					ps.setBoolean(12, rankedcountry.getProtection());
					// set create timestamp
					ps.setLong(13, System.currentTimeMillis());
					int rows = ps.executeUpdate();
					if (rows!=1)
						throw new DAOException("Create failed, updated rows: "+rows);
					RankedCountryVO newRankedcountry = new RankedCountryVO(""+nextId);
					newRankedcountry.copyAttributesFrom(rankedcountry);
					ret.add(newRankedcountry);
				}
				con.commit();
				return ret;
			} catch (SQLException e) {
				getLastId(con).set(getMaxId(con,TABNAME));
				log.warn("Failed attempt" +recoveryAttempt+ " from " +dbConfig.getIdRecoveryAttempts()+ " to create new entries (list) in "+TABNAME+" table", e);
				throwable = e;
				continue;
			} finally {
				net.anotheria.db.util.JDBCUtil.release(ps);
			}
		}
		log.error("All "+ dbConfig.getIdRecoveryAttempts()+" attempt of id rereading - Failed. "+"createRankedCountrys("+con+", "+list+")", throwable);
		throw new DAOSQLException(throwable);
	}

	/**
	 * Updates a RankedCountry object.
	 * Returns the updated version.
	 */
	public RankedCountry updateRankedCountry(Connection con, RankedCountry rankedcountry) throws DAOException {
		PreparedStatement ps = null;
		try {
			con.setAutoCommit(true);
			ps = con.prepareStatement(createSQL(SQL_UPDATE_1, SQL_UPDATE_2));
			ps.setInt(1, rankedcountry.getRank());
			ps.setString(2, rankedcountry.getCountryName());
			ps.setInt(3, rankedcountry.getCountryId());
			ps.setInt(4, rankedcountry.getLand());
			ps.setInt(5, rankedcountry.getNetworth());
			ps.setInt(6, rankedcountry.getColor());
			ps.setString(7, rankedcountry.getClan());
			ps.setInt(8, rankedcountry.getGov());
			ps.setBoolean(9, rankedcountry.getGdi());
			ps.setBoolean(10, rankedcountry.getDead());
			ps.setBoolean(11, rankedcountry.getProtection());
			// set update timestamp
			ps.setLong(12, System.currentTimeMillis());
			// set id for the where clause
			ps.setLong(13, Long.parseLong(rankedcountry.getId()));
			int rows = ps.executeUpdate();
			if (rows!=1)
				throw new DAOException("Update failed, updated rows: "+rows);
			return rankedcountry;
		} catch (SQLException e) {
			log.error("updateRankedCountry("+con+", "+rankedcountry+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Updates multiple new RankedCountry objects.
	 * Returns the updated versions.
	 */
	public List<RankedCountry> updateRankedCountrys(Connection con, List<RankedCountry> list) throws DAOException {
		PreparedStatement ps = null;
		try{
			con.setAutoCommit(false);
			ps = con.prepareStatement(createSQL(SQL_UPDATE_1, SQL_UPDATE_2));
			List<RankedCountry> ret = new ArrayList<RankedCountry>();
			for (RankedCountry rankedcountry : list){
				ps.setInt(1, rankedcountry.getRank());
				ps.setString(2, rankedcountry.getCountryName());
				ps.setInt(3, rankedcountry.getCountryId());
				ps.setInt(4, rankedcountry.getLand());
				ps.setInt(5, rankedcountry.getNetworth());
				ps.setInt(6, rankedcountry.getColor());
				ps.setString(7, rankedcountry.getClan());
				ps.setInt(8, rankedcountry.getGov());
				ps.setBoolean(9, rankedcountry.getGdi());
				ps.setBoolean(10, rankedcountry.getDead());
				ps.setBoolean(11, rankedcountry.getProtection());
				// set update timestamp
				ps.setLong(12, System.currentTimeMillis());
				// set id for the where clause
				ps.setLong(13, Long.parseLong(rankedcountry.getId()));
				int rows = ps.executeUpdate();
				if (rows!=1)
					throw new DAOException("Update failed, updated rows: "+rows);
			}
			con.commit();
			return list;
		} catch (SQLException e) {
			log.error("updateRankedCountrys("+con+", "+list+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Returns all RankedCountrys objects stored which matches given properties.
	 */
	public List<RankedCountry> getRankedCountrysByProperty(Connection con, List<QueryProperty> properties) throws DAOException {
		PreparedStatement ps = null;
		ResultSet result = null;
		try {
			// //enable caching of statements one day
			String SQL = createSQL(SQL_READ_ALL_BY_PROPERTY_1, SQL_READ_ALL_BY_PROPERTY_2);
			String whereClause = "";
			for (QueryProperty p : properties){
				if (whereClause.length()>0)
					whereClause += " AND ";
				String statement = p.unprepaireable()? (String) p.getValue(): "?";
				whereClause += p.getName().toLowerCase()+p.getComparator()+statement;
			}
			SQL += whereClause;
			ps = con.prepareStatement(SQL);
			int propertyPosition = 0;
			for (QueryProperty property: properties){
				if(property.unprepaireable())
					continue;
				setProperty(++propertyPosition, ps, property);
			}
			result = ps.executeQuery();
			ArrayList<RankedCountry> ret = new ArrayList<RankedCountry>();
			while(result.next())
				ret.add(rowMapper.map(result));
			return  ret;
		} catch (SQLException e) {
			log.error("getRankedCountrysByProperty("+con+","+ properties+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Returns RankedCountrys objects count.
	 */
	public int getRankedCountrysCount(Connection con) throws DAOException {
		PreparedStatement ps = null;
		ResultSet result = null;
		try {
			ps = con.prepareStatement(SQL_COUNT_1 + TABNAME);
			result = ps.executeQuery();
			int pCount = 0;
			if (result.next())
				pCount = result.getInt(1);
			return pCount;
		} catch (SQLException e) {
			log.error("getRankedCountrysCount(" + con + ")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Returns RankedCountrys objects segment.
	 */
	public List<RankedCountry> getRankedCountrys(Connection con, Segment aSegment) throws DAOException {
		PreparedStatement ps = null;
		ResultSet result = null;
		try {
			con.setAutoCommit(true);
			ps = con.prepareStatement(createSQL(SQL_READ_ALL_1, SQL_READ_ALL_2) + SQL_LIMIT_1 + SQL_OFFSET_1);
			int pLimit = aSegment.getElementsPerSlice();
			int pOffset = aSegment.getSliceNumber() * aSegment.getElementsPerSlice() - aSegment.getElementsPerSlice();
			ps.setInt(1, pLimit);
			ps.setInt(2, pOffset);
			result = ps.executeQuery();
			ArrayList<RankedCountry> ret = new ArrayList<RankedCountry>();
			while(result.next())
				ret.add(rowMapper.map(result));
			return  ret;
		} catch (SQLException e) {
			log.error("getRankedCountrys(" + con + ","+ aSegment +")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	/**
	 * Returns RankedCountrys objects segment which matches given properties.
	 */
	public List<RankedCountry> getRankedCountrysByProperty(Connection con, Segment aSegment, List<QueryProperty> properties) throws DAOException {
		PreparedStatement ps = null;
		ResultSet result = null;
		try {
			// //enable caching of statements one day
			String SQL = createSQL(SQL_READ_ALL_BY_PROPERTY_1, SQL_READ_ALL_BY_PROPERTY_2);
			String whereClause = "";
			for (QueryProperty p : properties){
				if (whereClause.length()>0)
					whereClause += " AND ";
				String statement = p.unprepaireable()? (String) p.getValue(): "?";
				whereClause += p.getName()+p.getComparator()+statement;
			}
			SQL += whereClause;
			SQL += SQL_READ_ALL_2 + SQL_LIMIT_1 + SQL_OFFSET_1;
			ps = con.prepareStatement(SQL);
			int propertyPosition = 0;
			for (QueryProperty property: properties){
				if(property.unprepaireable())
					continue;
				setProperty(++propertyPosition, ps, property);
			}
			int pLimit = aSegment.getElementsPerSlice();
			int pOffset = aSegment.getSliceNumber() * aSegment.getElementsPerSlice() - aSegment.getElementsPerSlice();
			ps.setInt(++propertyPosition, pLimit);
			ps.setInt(++propertyPosition, pOffset);
			result = ps.executeQuery();
			ArrayList<RankedCountry> ret = new ArrayList<RankedCountry>();
			while(result.next())
				ret.add(rowMapper.map(result));
			return  ret;
		} catch (SQLException e) {
			log.error("getRankedCountrysByProperty(" + con + "," + aSegment + "," + properties + ")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(ps);
		}
	}

	private void setProperty(int position, PreparedStatement ps, QueryProperty property) throws SQLException {
		if(property.unprepaireable()){
			return;
		}
		if (ATT_NAME_RANK.equals(property.getName().toLowerCase())){
			ps.setInt(position, (Integer)property.getValue());
			return;
		}
		if (ATT_NAME_COUNTRYNAME.equals(property.getName().toLowerCase())){
			ps.setString(position, (String)property.getValue());
			return;
		}
		if (ATT_NAME_COUNTRYID.equals(property.getName().toLowerCase())){
			ps.setInt(position, (Integer)property.getValue());
			return;
		}
		if (ATT_NAME_LAND.equals(property.getName().toLowerCase())){
			ps.setInt(position, (Integer)property.getValue());
			return;
		}
		if (ATT_NAME_NETWORTH.equals(property.getName().toLowerCase())){
			ps.setInt(position, (Integer)property.getValue());
			return;
		}
		if (ATT_NAME_COLOR.equals(property.getName().toLowerCase())){
			ps.setInt(position, (Integer)property.getValue());
			return;
		}
		if (ATT_NAME_CLAN.equals(property.getName().toLowerCase())){
			ps.setString(position, (String)property.getValue());
			return;
		}
		if (ATT_NAME_GOV.equals(property.getName().toLowerCase())){
			ps.setInt(position, (Integer)property.getValue());
			return;
		}
		if (ATT_NAME_GDI.equals(property.getName().toLowerCase())){
			ps.setBoolean(position, (Boolean)property.getValue());
			return;
		}
		if (ATT_NAME_DEAD.equals(property.getName().toLowerCase())){
			ps.setBoolean(position, (Boolean)property.getValue());
			return;
		}
		if (ATT_NAME_PROTECTION.equals(property.getName().toLowerCase())){
			ps.setBoolean(position, (Boolean)property.getValue());
			return;
		}
		if (ATT_NAME_ID.equals(property.getName())){
			ps.setLong(position, (Long)property.getValue());
			return;
		}
		if ("dao_created".equals(property.getName())){
			ps.setLong(position, (Long)property.getValue());
			return;
		}
		if ("dao_updated".equals(property.getName())){
			ps.setLong(position, (Long)property.getValue());
			return;
		}
	}
	/* ---------- SQL --------- 
	CREATE TABLE rankedcountry(
	id int8 PRIMARY KEY,
	rank int,
	countryname varchar,
	countryid int,
	land int,
	networth int,
	color int,
	clan varchar,
	gov int,
	gdi boolean,
	dead boolean,
	protection boolean,
	dao_created int8,
	dao_updated int8
	)
	   ---------- SQL --------- */
	public void createStructure(Connection connection)  throws DAOException {
		// not implemented
	}

	/* ---------- SQL --------- 
	DROP TABLE rankedcountry
	   ---------- SQL --------- */
	public void deleteStructure(Connection connection)  throws DAOException {
		// not implemented
	}

	private long getMaxId(Connection con, String tableName)  throws DAOException {
		Statement st = null;
		ResultSet result = null;
		try {
			con.setAutoCommit(true);
			st = con.createStatement();
			st.execute("SELECT MAX("+ATT_NAME_ID+") FROM "+tableName);
			result = st.getResultSet();
			long maxId = 0;
			if (result.next())
				maxId = result.getLong(1);
			log.info("maxId in table "+tableName+" is "+maxId);
			return maxId;
		} catch (SQLException e) {
			log.error("getMaxId("+con+", "+tableName+")", e);
			throw new DAOSQLException(e);
		} finally {
			net.anotheria.db.util.JDBCUtil.release(result);
			net.anotheria.db.util.JDBCUtil.release(st);
		}
	}

	public void init(Connection con)  throws DAOException {
		log.debug("Called: init("+con+")");
		long maxId = getMaxId(con, TABNAME);
		maxId = maxId >= dbConfig.getStartId() ? maxId : dbConfig.getStartId();
		lastId = new AtomicLong(maxId);
	}
}
